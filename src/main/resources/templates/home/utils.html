<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Utilidades • RemoteReady</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50:'#eff6ff',100:'#dbeafe',200:'#bfdbfe',300:'#93c5fd',
                            400:'#60a5fa',500:'#3b82f6',600:'#2563eb',700:'#1d4ed8',
                            800:'#1e40af',900:'#1e3a8a'
                        }
                    }
                }
            }
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html,body{height:100%}
        body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 text-slate-900">

<header class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50">
    <div class="mx-auto max-w-6xl px-6 py-4 flex items-center justify-between">
        <a th:href="@{/home}" class="flex items-center gap-3">
            <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-brand-600 text-white shadow-lg shadow-brand-500/30">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
            </div>
            <h1 class="text-xl font-bold">Remote<span class="text-brand-600">Ready</span></h1>
        </a>

        <a th:href="@{/logout}"
           class="text-sm text-slate-500 hover:text-slate-900 font-medium hover:underline transition">
            Sair
        </a>
    </div>
</header>

<main class="mx-auto max-w-6xl px-6 py-10">
    <div class="mb-8">
        <h2 class="text-3xl font-extrabold tracking-tight text-slate-900">Utilidades</h2>
        <p class="mt-2 text-sm text-slate-600">
            Consulte o histórico de conversas do RemoteCoach e o relatório de elegibilidade para certificados.
        </p>
    </div>

    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">

        <!-- Card: Histórico de Chat -->
        <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-lg shadow-slate-200/50">
            <div class="flex items-center justify-between gap-4 mb-4">
                <div>
                    <h3 class="text-xl font-bold text-slate-900">Histórico RemoteCoach</h3>
                    <p class="mt-1 text-xs text-slate-500">
                        Informe o ID do usuário para ver as últimas interações com o RemoteCoach.
                    </p>
                </div>
                <div class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-blue-100 text-blue-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4 5a2 2 0 012-2h12a1 1 0 110 2H6v9h3v3l3-3h6V8a1 1 0 112 0v7a2 2 0 01-2 2h-5.586l-2.707 2.707A1 1 0 0110 19v-2H6a2 2 0 01-2-2V5z"/>
                    </svg>
                </div>
            </div>

            <form th:action="@{/utils/historico}" method="post" class="flex items-end gap-3 mb-4">
                <div class="flex-1">
                    <label for="userId" class="block text-xs font-medium text-slate-600 mb-1">
                        ID do Usuário
                    </label>
                    <input id="userId" name="userId" type="number" min="1"
                           th:value="${userId}"
                           class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm shadow-sm
                                  focus:border-brand-500 focus:ring-2 focus:ring-brand-400 focus:outline-none"
                           placeholder="Ex.: 2">
                </div>

                <input type="hidden" name="dias" th:value="${dias}"/>

                <button type="submit"
                        class="inline-flex items-center gap-2 rounded-xl bg-brand-600 px-4 py-2.5 text-sm font-semibold text-white shadow-md shadow-brand-500/30
                               hover:bg-brand-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M11 3a1 1 0 011 1v8h8a1 1 0 010 2h-8v8a1 1 0 01-2 0v-8H2a1 1 0 010-2h8V4a1 1 0 011-1z"/>
                    </svg>
                    Buscar histórico
                </button>
            </form>

            <div th:if="${historicoErro}" class="rounded-xl bg-red-50 border border-red-100 px-4 py-3 text-xs text-red-700 mb-3">
                <p th:text="${historicoErro}">Usuário não encontrado.</p>
            </div>

            <div th:if="${historico}" class="space-y-4">
                <div class="rounded-xl bg-slate-50 border border-slate-200 px-4 py-3 text-xs">
                    <p class="font-semibold text-slate-800">
                        Usuário ID: <span th:text="${historico.idUsuario}">2</span>
                    </p>
                    <p class="text-slate-700">
                        Nome: <span th:text="${historico.nome}">João Silva</span>
                    </p>
                    <p class="text-slate-700">
                        Email: <span th:text="${historico.email}">joao@email</span>
                    </p>
                </div>

                <div class="border-t border-slate-200 pt-3">
                    <h4 class="text-xs font-semibold text-slate-600 mb-2">
                        Conversas com RemoteCoach
                    </h4>

                    <div th:if="${#lists.isEmpty(historico.mensagens)}"
                         class="text-xs text-slate-500">
                        Nenhuma interação registrada ainda.
                    </div>

                    <div th:each="chat : ${historico.mensagens}"
                         class="mb-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-xs">
                        <div class="flex items-center justify-between mb-1.5">
                            <span class="font-semibold text-slate-800">
                                Chat #<span th:text="${chat.idChat}">1</span>
                            </span>
                            <span class="text-[11px] text-slate-500"
                                  th:text="${#temporals.format(chat.data, 'dd/MM/yyyy HH:mm:ss')}">
                                18/11/2025 19:46:49
                            </span>
                        </div>
                        <p class="text-slate-700">
                            <span class="font-semibold">Pergunta:</span>
                            <span th:text="${chat.pergunta}">Pergunta...</span>
                        </p>
                        <p class="mt-1 text-slate-700">
                            <span class="font-semibold">Resposta:</span>
                            <span th:text="${chat.resposta != null ? chat.resposta : 'Resposta pendente'}">
                                Resposta...
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Card: Relatório de Elegibilidade -->
        <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-lg shadow-slate-200/50">
            <div class="flex items-center justify-between gap-4 mb-4">
                <div>
                    <h3 class="text-xl font-bold text-slate-900">Relatório de Elegibilidade</h3>
                    <p class="mt-1 text-xs text-slate-500">
                        Verifica quem já está apto a receber certificado (10+ posts lidos).
                    </p>
                </div>
                <div class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-100 text-emerald-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2a7 7 0 00-7 7v3.268A2 2 0 005 14.73l1.553 4.658A2 2 0 008.447 21h7.106a2 2 0 001.894-1.612L19 14.73a2 2 0 00.053-.462V9a7 7 0 00-7-7zm0 3a1 1 0 01.993.883L13 6v4a1 1 0 01-1.993.117L11 10V6a1 1 0 011-1z"/>
                    </svg>
                </div>
            </div>

            <form th:action="@{/utils/relatorio}" method="post" class="flex items-end gap-3 mb-4">
                <div>
                    <label for="dias" class="block text-xs font-medium text-slate-600 mb-1">
                        Período (últimos dias)
                    </label>
                    <input id="dias" name="dias" type="number" min="1"
                           th:value="${dias}"
                           class="w-24 rounded-xl border border-slate-300 px-3 py-2 text-sm shadow-sm
                                  focus:border-brand-500 focus:ring-2 focus:ring-brand-400 focus:outline-none">
                </div>

                <input type="hidden" name="userId" th:value="${userId}"/>

                <button type="submit"
                        class="inline-flex items-center gap-2 rounded-xl bg-slate-900 px-4 py-2.5 text-sm font-semibold text-white shadow-md
                               hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-700 focus-visible:ring-offset-2">
                    Atualizar relatório
                </button>
            </form>

            <div th:if="${relatorio}" class="space-y-4">
                <p class="text-[11px] text-slate-500">
                    Período:
                    <span th:text="${#temporals.format(relatorio.dataInicio, 'dd/MM/yyyy')}">19/10/2025</span>
                    até
                    <span th:text="${#temporals.format(relatorio.dataFim, 'dd/MM/yyyy')}">18/11/2025</span>
                </p>

                <!-- Aptos -->
                <div class="border-t border-slate-200 pt-3">
                    <h4 class="text-xs font-semibold text-emerald-700 mb-2">
                        Usuários aptos a receber certificado (10+ posts lidos)
                    </h4>

                    <div th:if="${#lists.isEmpty(relatorio.usuariosAptos)}"
                         class="text-xs text-slate-500">
                        Nenhum usuário apto ainda.
                    </div>

                    <ul th:if="${!#lists.isEmpty(relatorio.usuariosAptos)}"
                        class="space-y-2 text-xs">
                        <li th:each="u : ${relatorio.usuariosAptos}"
                            class="rounded-xl border border-emerald-100 bg-emerald-50 px-3 py-2 flex justify-between items-center">
                            <div>
                                <p class="font-semibold text-emerald-800" th:text="${u.nome}">Nome</p>
                                <p class="text-[11px] text-emerald-700">
                                    ID: <span th:text="${u.idUsuario}">1</span> •
                                    Email: <span th:text="${u.email}">email</span>
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-[11px] text-emerald-700">
                                    Posts lidos: <span th:text="${u.postsLidos}">10</span>
                                </p>
                                <p class="text-[11px] font-semibold"
                                   th:text="${u.statusCertificado}">
                                    PODE EMITIR
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Não aptos -->
                <div class="border-t border-slate-200 pt-3">
                    <h4 class="text-xs font-semibold text-slate-700 mb-2">
                        Usuários ainda não aptos (menos de 10 posts)
                    </h4>

                    <div th:if="${#lists.isEmpty(relatorio.usuariosNaoAptos)}"
                         class="text-xs text-slate-500">
                        Nenhum usuário cadastrado.
                    </div>

                    <ul th:if="${!#lists.isEmpty(relatorio.usuariosNaoAptos)}"
                        class="space-y-2 text-xs">
                        <li th:each="u : ${relatorio.usuariosNaoAptos}"
                            class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 flex justify-between items-center">
                            <div>
                                <p class="font-semibold text-slate-800" th:text="${u.nome}">Nome</p>
                                <p class="text-[11px] text-slate-600">
                                    ID: <span th:text="${u.idUsuario}">1</span>
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-[11px] text-slate-600">
                                    Lidos: <span th:text="${u.postsLidos}">3</span>
                                </p>
                                <p class="text-[11px] text-slate-500">
                                    Faltam: <span th:text="${u.faltam}">7</span>
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

    </div>
</main>

<footer class="pb-8 text-center text-xs text-slate-500">
    <p>© 2025 RemoteReady • Plataforma de Gestão de Trabalho Remoto</p>
</footer>

</body>
</html>
